import{__values,__spreadArray,__read,__extends,__assign}from"tslib";function isFunction(value){return"function"==typeof value}function operate(init){return function(source){if(function(source){return isFunction(null==source?void 0:source.lift)}(source))return source.lift(function(liftedSource){try{return init(liftedSource,this)}catch(err){this.error(err)}});throw new TypeError("Unable to lift unknown Observable type")}}function createErrorClass(createImpl){var ctorFunc=createImpl(function(instance){Error.call(instance),instance.stack=new Error().stack});return ctorFunc.prototype=Object.create(Error.prototype),ctorFunc.prototype.constructor=ctorFunc,ctorFunc}var UnsubscriptionError=createErrorClass(function(_super){return function(errors){_super(this),this.message=errors?errors.length+" errors occurred during unsubscription:\n"+errors.map(function(err,i){return i+1+") "+err.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=errors}});function arrRemove(arr,item){if(arr){var index=arr.indexOf(item);0<=index&&arr.splice(index,1)}}var Subscription=function(){function Subscription(initialTeardown){this.initialTeardown=initialTeardown,this.closed=!1,this._parentage=null,this._finalizers=null}var empty;return Subscription.prototype.unsubscribe=function(){var e_1,_a,e_2,_b,errors;if(!this.closed){this.closed=!0;var _parentage=this._parentage;if(_parentage)if(this._parentage=null,Array.isArray(_parentage))try{for(var _parentage_1=__values(_parentage),_parentage_1_1=_parentage_1.next();!_parentage_1_1.done;_parentage_1_1=_parentage_1.next()){_parentage_1_1.value.remove(this)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_parentage_1_1&&!_parentage_1_1.done&&(_a=_parentage_1.return)&&_a.call(_parentage_1)}finally{if(e_1)throw e_1.error}}else _parentage.remove(this);var initialFinalizer=this.initialTeardown;if(isFunction(initialFinalizer))try{initialFinalizer()}catch(e){errors=e instanceof UnsubscriptionError?e.errors:[e]}var _finalizers=this._finalizers;if(_finalizers){this._finalizers=null;try{for(var _finalizers_1=__values(_finalizers),_finalizers_1_1=_finalizers_1.next();!_finalizers_1_1.done;_finalizers_1_1=_finalizers_1.next()){var finalizer=_finalizers_1_1.value;try{execFinalizer(finalizer)}catch(err){errors=null!=errors?errors:[],err instanceof UnsubscriptionError?errors=__spreadArray(__spreadArray([],__read(errors)),__read(err.errors)):errors.push(err)}}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_finalizers_1_1&&!_finalizers_1_1.done&&(_b=_finalizers_1.return)&&_b.call(_finalizers_1)}finally{if(e_2)throw e_2.error}}}if(errors)throw new UnsubscriptionError(errors)}},Subscription.prototype.add=function(teardown){var _a;if(teardown&&teardown!==this)if(this.closed)execFinalizer(teardown);else{if(teardown instanceof Subscription){if(teardown.closed||teardown._hasParent(this))return;teardown._addParent(this)}(this._finalizers=null!==(_a=this._finalizers)&&void 0!==_a?_a:[]).push(teardown)}},Subscription.prototype._hasParent=function(parent){var _parentage=this._parentage;return _parentage===parent||Array.isArray(_parentage)&&_parentage.includes(parent)},Subscription.prototype._addParent=function(parent){var _parentage=this._parentage;this._parentage=Array.isArray(_parentage)?(_parentage.push(parent),_parentage):_parentage?[_parentage,parent]:parent},Subscription.prototype._removeParent=function(parent){var _parentage=this._parentage;_parentage===parent?this._parentage=null:Array.isArray(_parentage)&&arrRemove(_parentage,parent)},Subscription.prototype.remove=function(teardown){var _finalizers=this._finalizers;_finalizers&&arrRemove(_finalizers,teardown),teardown instanceof Subscription&&teardown._removeParent(this)},Subscription.EMPTY=((empty=new Subscription).closed=!0,empty),Subscription}();function isSubscription(value){return value instanceof Subscription||value&&"closed"in value&&isFunction(value.remove)&&isFunction(value.add)&&isFunction(value.unsubscribe)}function execFinalizer(finalizer){isFunction(finalizer)?finalizer():finalizer.unsubscribe()}Subscription.EMPTY;var config={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},timeoutProvider_setTimeout=function(handler,timeout){for(var args=[],_i=2;_i<arguments.length;_i++)args[_i-2]=arguments[_i];return setTimeout.apply(void 0,__spreadArray([handler,timeout],__read(args)))};function noop(){}var Subscriber=function(_super){function Subscriber(destination){var _this=_super.call(this)||this;return _this.isStopped=!1,destination?(_this.destination=destination,isSubscription(destination)&&destination.add(_this)):_this.destination=EMPTY_OBSERVER,_this}return __extends(Subscriber,_super),Subscriber.create=function(next,error,complete){return new SafeSubscriber(next,error,complete)},Subscriber.prototype.next=function(value){this.isStopped||this._next(value)},Subscriber.prototype.error=function(err){this.isStopped||(this.isStopped=!0,this._error(err))},Subscriber.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},Subscriber.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,_super.prototype.unsubscribe.call(this),this.destination=null)},Subscriber.prototype._next=function(value){this.destination.next(value)},Subscriber.prototype._error=function(err){try{this.destination.error(err)}finally{this.unsubscribe()}},Subscriber.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},Subscriber}(Subscription),_bind=Function.prototype.bind;function bind(fn,thisArg){return _bind.call(fn,thisArg)}var ConsumerObserver=function(){function ConsumerObserver(partialObserver){this.partialObserver=partialObserver}return ConsumerObserver.prototype.next=function(value){var partialObserver=this.partialObserver;if(partialObserver.next)try{partialObserver.next(value)}catch(error){handleUnhandledError(error)}},ConsumerObserver.prototype.error=function(err){var partialObserver=this.partialObserver;if(partialObserver.error)try{partialObserver.error(err)}catch(error){handleUnhandledError(error)}else handleUnhandledError(err)},ConsumerObserver.prototype.complete=function(){var partialObserver=this.partialObserver;if(partialObserver.complete)try{partialObserver.complete()}catch(error){handleUnhandledError(error)}},ConsumerObserver}(),SafeSubscriber=function(_super){function SafeSubscriber(observerOrNext,error,complete){var partialObserver,context_1,_this=_super.call(this)||this;isFunction(observerOrNext)||!observerOrNext?partialObserver={next:null!=observerOrNext?observerOrNext:void 0,error:null!=error?error:void 0,complete:null!=complete?complete:void 0}:_this&&config.useDeprecatedNextContext?((context_1=Object.create(observerOrNext)).unsubscribe=function(){return _this.unsubscribe()},partialObserver={next:observerOrNext.next&&bind(observerOrNext.next,context_1),error:observerOrNext.error&&bind(observerOrNext.error,context_1),complete:observerOrNext.complete&&bind(observerOrNext.complete,context_1)}):partialObserver=observerOrNext;return _this.destination=new ConsumerObserver(partialObserver),_this}return __extends(SafeSubscriber,_super),SafeSubscriber}(Subscriber);function handleUnhandledError(error){var err;err=error,timeoutProvider_setTimeout(function(){throw err})}var EMPTY_OBSERVER={closed:!0,next:noop,error:function(err){throw err},complete:noop};var OperatorSubscriber=function(_super){function OperatorSubscriber(destination,onNext,onComplete,onError,onFinalize,shouldUnsubscribe){var _this=_super.call(this,destination)||this;return _this.onFinalize=onFinalize,_this.shouldUnsubscribe=shouldUnsubscribe,_this._next=onNext?function(value){try{onNext(value)}catch(err){destination.error(err)}}:_super.prototype._next,_this._error=onError?function(err){try{onError(err)}catch(err){destination.error(err)}finally{this.unsubscribe()}}:_super.prototype._error,_this._complete=onComplete?function(){try{onComplete()}catch(err){destination.error(err)}finally{this.unsubscribe()}}:_super.prototype._complete,_this}return __extends(OperatorSubscriber,_super),OperatorSubscriber.prototype.unsubscribe=function(){var _a;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var closed_1=this.closed;_super.prototype.unsubscribe.call(this),!closed_1&&(null===(_a=this.onFinalize)||void 0===_a||_a.call(this))}},OperatorSubscriber}(Subscriber);var observable="function"==typeof Symbol&&Symbol.observable||"@@observable";function identity(x){return x}function pipeFromArray(fns){return 0===fns.length?identity:1===fns.length?fns[0]:function(input){return fns.reduce(function(prev,fn){return fn(prev)},input)}}var Observable=function(){function Observable(subscribe){subscribe&&(this._subscribe=subscribe)}return Observable.prototype.lift=function(operator){var observable=new Observable;return observable.source=this,observable.operator=operator,observable},Observable.prototype.subscribe=function(observerOrNext,error,complete){var value,_this=this,subscriber=(value=observerOrNext)&&value instanceof Subscriber||function(value){return value&&isFunction(value.next)&&isFunction(value.error)&&isFunction(value.complete)}(value)&&isSubscription(value)?observerOrNext:new SafeSubscriber(observerOrNext,error,complete);return function(){var _a=_this,operator=_a.operator,source=_a.source;subscriber.add(operator?operator.call(subscriber,source):source?_this._subscribe(subscriber):_this._trySubscribe(subscriber))}(),subscriber},Observable.prototype._trySubscribe=function(sink){try{return this._subscribe(sink)}catch(err){sink.error(err)}},Observable.prototype.forEach=function(next,promiseCtor){var _this=this;return new(promiseCtor=getPromiseCtor(promiseCtor))(function(resolve,reject){var subscriber=new SafeSubscriber({next:function(value){try{next(value)}catch(err){reject(err),subscriber.unsubscribe()}},error:reject,complete:resolve});_this.subscribe(subscriber)})},Observable.prototype._subscribe=function(subscriber){var _a;return null===(_a=this.source)||void 0===_a?void 0:_a.subscribe(subscriber)},Observable.prototype[observable]=function(){return this},Observable.prototype.pipe=function(){for(var operations=[],_i=0;_i<arguments.length;_i++)operations[_i]=arguments[_i];return pipeFromArray(operations)(this)},Observable.prototype.toPromise=function(promiseCtor){var _this=this;return new(promiseCtor=getPromiseCtor(promiseCtor))(function(resolve,reject){var value;_this.subscribe(function(x){return value=x},function(err){return reject(err)},function(){return resolve(value)})})},Observable.create=function(subscribe){return new Observable(subscribe)},Observable}();function getPromiseCtor(promiseCtor){var _a;return null!==(_a=null!=promiseCtor?promiseCtor:config.Promise)&&void 0!==_a?_a:Promise}function getXHRResponse(xhr){switch(xhr.responseType){case"json":if("response"in xhr)return xhr.response;var ieXHR=xhr;return JSON.parse(ieXHR.responseText);case"document":return xhr.responseXML;default:return"response"in xhr?xhr.response:(ieXHR=xhr).responseText;}}var AjaxResponse=function(originalEvent,xhr,request,type){void 0===type&&(type="download_load"),this.originalEvent=originalEvent,this.xhr=xhr,this.request=request,this.type=type;var status=xhr.status,responseType=xhr.responseType;this.status=null!=status?status:0,this.responseType=null!=responseType?responseType:"";var allHeaders=xhr.getAllResponseHeaders();this.responseHeaders=allHeaders?allHeaders.split("\n").reduce(function(headers,line){var index=line.indexOf(": ");return headers[line.slice(0,index)]=line.slice(index+2),headers},{}):{},this.response=getXHRResponse(xhr);var loaded=originalEvent.loaded,total=originalEvent.total;this.loaded=loaded,this.total=total},AjaxError=createErrorClass(function(_super){return function(message,xhr,request){var response;this.message=message,this.name="AjaxError",this.xhr=xhr,this.request=request,this.status=xhr.status,this.responseType=xhr.responseType;try{response=getXHRResponse(xhr)}catch(err){response=xhr.responseText}this.response=response}}),AjaxTimeoutError=function(){function AjaxTimeoutErrorImpl(xhr,request){return AjaxError.call(this,"ajax timeout",xhr,request),this.name="AjaxTimeoutError",this}return AjaxTimeoutErrorImpl.prototype=Object.create(AjaxError.prototype),AjaxTimeoutErrorImpl}();function ajaxGet(url,headers){return ajax({method:"GET",url:url,headers:headers})}function ajaxPost(url,body,headers){return ajax({method:"POST",url:url,body:body,headers:headers})}function ajaxDelete(url,headers){return ajax({method:"DELETE",url:url,headers:headers})}function ajaxPut(url,body,headers){return ajax({method:"PUT",url:url,body:body,headers:headers})}function ajaxPatch(url,body,headers){return ajax({method:"PATCH",url:url,body:body,headers:headers})}var project,thisArg,mapResponse=(project=function(x){return x.response},operate(function(source,subscriber){var onComplete,onError,onFinalize,index=0;source.subscribe(new OperatorSubscriber(subscriber,function(value){subscriber.next(project.call(thisArg,value,index++))},onComplete,onError,onFinalize))}));function ajaxGetJSON(url,headers){return mapResponse(ajax({method:"GET",url:url,headers:headers}))}var create,ajax=(create=function(urlOrConfig){var init;return init="string"==typeof urlOrConfig?{url:urlOrConfig}:urlOrConfig,new Observable(function(destination){var _a,_b,searchParams_1,config=__assign({async:!0,crossDomain:!1,withCredentials:!1,method:"GET",timeout:0,responseType:"json"},init),queryParams=config.queryParams,configuredBody=config.body,configuredHeaders=config.headers,url=config.url;if(!url)throw new TypeError("url is required");if(queryParams)if(url.includes("?")){var parts=url.split("?");if(2<parts.length)throw new TypeError("invalid url");searchParams_1=new URLSearchParams(parts[1]),new URLSearchParams(queryParams).forEach(function(value,key){return searchParams_1.set(key,value)}),url=parts[0]+"?"+searchParams_1}else url=url+"?"+(searchParams_1=new URLSearchParams(queryParams));var headers={};if(configuredHeaders)for(var key in configuredHeaders)configuredHeaders.hasOwnProperty(key)&&(headers[key.toLowerCase()]=configuredHeaders[key]);var crossDomain=config.crossDomain;crossDomain||"x-requested-with"in headers||(headers["x-requested-with"]="XMLHttpRequest");var withCredentials=config.withCredentials,xsrfCookieName=config.xsrfCookieName,xsrfHeaderName=config.xsrfHeaderName;if((withCredentials||!crossDomain)&&xsrfCookieName&&xsrfHeaderName){var xsrfCookie=null!==(_b=null===(_a=null===document||void 0===document?void 0:document.cookie.match(new RegExp("(^|;\\s*)("+xsrfCookieName+")=([^;]*)")))||void 0===_a?void 0:_a.pop())&&void 0!==_b?_b:"";xsrfCookie&&(headers[xsrfHeaderName]=xsrfCookie)}var xhr,body=function(body,headers){var _a;if(!body||"string"==typeof body||function(body){return"undefined"!=typeof FormData&&body instanceof FormData}(body)||function(body){return"undefined"!=typeof URLSearchParams&&body instanceof URLSearchParams}(body)||function(body){return toStringCheck(body,"ArrayBuffer")}(body)||function(body){return toStringCheck(body,"File")}(body)||function(body){return toStringCheck(body,"Blob")}(body)||function(body){return"undefined"!=typeof ReadableStream&&body instanceof ReadableStream}(body))return body;if(function(body){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(body)}(body))return body.buffer;if("object"==typeof body)return headers["content-type"]=null!==(_a=headers["content-type"])&&void 0!==_a?_a:"application/json;charset=utf-8",JSON.stringify(body);throw new TypeError("Unknown body type")}(configuredBody,headers),_request=__assign(__assign({},config),{url:url,headers:headers,body:body});xhr=init.createXHR?init.createXHR():new XMLHttpRequest;var progressSubscriber_1=init.progressSubscriber,_c=init.includeDownloadProgress,includeDownloadProgress=void 0!==_c&&_c,_d=init.includeUploadProgress,includeUploadProgress=void 0!==_d&&_d,addErrorEvent=function(type,errorFactory){xhr.addEventListener(type,function(){var _a,error=errorFactory();null===(_a=null==progressSubscriber_1?void 0:progressSubscriber_1.error)||void 0===_a||_a.call(progressSubscriber_1,error),destination.error(error)})};addErrorEvent("timeout",function(){return new AjaxTimeoutError(xhr,_request)}),addErrorEvent("abort",function(){return new AjaxError("aborted",xhr,_request)});var createResponse_1=function(direction,event){return new AjaxResponse(event,xhr,_request,direction+"_"+event.type)},addProgressEvent_1=function(target,type,direction){target.addEventListener(type,function(event){destination.next(createResponse_1(direction,event))})};includeUploadProgress&&[LOADSTART,PROGRESS,LOAD].forEach(function(type){return addProgressEvent_1(xhr.upload,type,"upload")}),progressSubscriber_1&&[LOADSTART,PROGRESS].forEach(function(type){return xhr.upload.addEventListener(type,function(e){var _a;return null===(_a=null==progressSubscriber_1?void 0:progressSubscriber_1.next)||void 0===_a?void 0:_a.call(progressSubscriber_1,e)})}),includeDownloadProgress&&[LOADSTART,PROGRESS].forEach(function(type){return addProgressEvent_1(xhr,type,"download")});var emitError_1=function(status){var msg="ajax error"+(status?" "+status:"");destination.error(new AjaxError(msg,xhr,_request))};xhr.addEventListener("error",function(e){var _a;null===(_a=null==progressSubscriber_1?void 0:progressSubscriber_1.error)||void 0===_a||_a.call(progressSubscriber_1,e),emitError_1()}),xhr.addEventListener(LOAD,function(event){var _a,_b,status=xhr.status;if(status<400){null===(_a=null==progressSubscriber_1?void 0:progressSubscriber_1.complete)||void 0===_a||_a.call(progressSubscriber_1);var response=void 0;try{response=createResponse_1("download",event)}catch(err){return void destination.error(err)}destination.next(response),destination.complete()}else null===(_b=null==progressSubscriber_1?void 0:progressSubscriber_1.error)||void 0===_b||_b.call(progressSubscriber_1,event),emitError_1(status)});var user=_request.user,method=_request.method,async=_request.async;for(var key in user?xhr.open(method,url,async,user,_request.password):xhr.open(method,url,async),async&&(xhr.timeout=_request.timeout,xhr.responseType=_request.responseType),"withCredentials"in xhr&&(xhr.withCredentials=_request.withCredentials),headers)headers.hasOwnProperty(key)&&xhr.setRequestHeader(key,headers[key]);return body?xhr.send(body):xhr.send(),function(){xhr&&4!==xhr.readyState&&xhr.abort()}})},create.get=ajaxGet,create.post=ajaxPost,create.delete=ajaxDelete,create.put=ajaxPut,create.patch=ajaxPatch,create.getJSON=ajaxGetJSON,create),LOADSTART="loadstart",PROGRESS="progress",LOAD="load";var _toString=Object.prototype.toString;function toStringCheck(obj,name){return _toString.call(obj)==="[object "+name+"]"}export{AjaxError,AjaxResponse,AjaxTimeoutError,ajax};