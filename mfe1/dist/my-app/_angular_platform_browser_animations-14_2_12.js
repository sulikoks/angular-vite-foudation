import*as i0 from"@angular/core";import{Injectable,Inject,NgModule,ViewEncapsulation,ANIMATION_MODULE_TYPE,RendererFactory2,NgZone}from"@angular/core";export{ANIMATION_MODULE_TYPE}from"@angular/core";import{BrowserModule,ɵDomRendererFactory2}from"@angular/platform-browser";import{AnimationBuilder,sequence,AnimationFactory}from"@angular/animations";import*as i1 from"@angular/animations/browser";import{ɵAnimationEngine,AnimationDriver,ɵWebAnimationsDriver,ɵNoopAnimationDriver,ɵAnimationStyleNormalizer,ɵWebAnimationsStyleNormalizer}from"@angular/animations/browser";import{DOCUMENT}from"@angular/common";class BrowserAnimationBuilder extends AnimationBuilder{constructor(rootRenderer,doc){super(),this._nextAnimationId=0;const typeData={id:"0",encapsulation:ViewEncapsulation.None,styles:[],data:{animation:[]}};this._renderer=rootRenderer.createRenderer(doc.body,typeData)}build(animation){const id=this._nextAnimationId.toString();this._nextAnimationId++;const entry=Array.isArray(animation)?sequence(animation):animation;return issueAnimationCommand(this._renderer,null,id,"register",[entry]),new BrowserAnimationFactory(id,this._renderer)}}BrowserAnimationBuilder.ɵfac=function BrowserAnimationBuilder_Factory(t){return new(t||BrowserAnimationBuilder)(i0.ɵɵinject(i0.RendererFactory2),i0.ɵɵinject(DOCUMENT))},BrowserAnimationBuilder.ɵprov=/* @__PURE__ */i0.ɵɵdefineInjectable({token:BrowserAnimationBuilder,factory:BrowserAnimationBuilder.ɵfac}),function(){(typeof ngDevMode==="undefined"||ngDevMode)&&i0.ɵsetClassMetadata(BrowserAnimationBuilder,[{type:Injectable}],function(){return[{type:i0.RendererFactory2},{type:void 0,decorators:[{type:Inject,args:[DOCUMENT]}]}]},null)}();class BrowserAnimationFactory extends AnimationFactory{constructor(_id,_renderer){super(),this._id=_id,this._renderer=_renderer}create(element,options){return new RendererAnimationPlayer(this._id,element,options||{},this._renderer)}}class RendererAnimationPlayer{constructor(id,element,options,_renderer){this.id=id,this.element=element,this._renderer=_renderer,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",options)}_listen(eventName,callback){return this._renderer.listen(this.element,`@@${this.id}:${eventName}`,callback)}_command(command,...args){return issueAnimationCommand(this._renderer,this.element,this.id,command,args)}onDone(fn){this._listen("done",fn)}onStart(fn){this._listen("start",fn)}onDestroy(fn){this._listen("destroy",fn)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(p){this._command("setPosition",p)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function issueAnimationCommand(renderer,element,id,command,args){return renderer.setProperty(element,`@@${id}:${command}`,args)}class AnimationRendererFactory{constructor(delegate,engine,_zone){this.delegate=delegate,this.engine=engine,this._zone=_zone,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),engine.onRemovalComplete=(element,delegate)=>{const parentNode=delegate?.parentNode(element);parentNode&&delegate.removeChild(parentNode,element)}}createRenderer(hostElement,type){const delegate=this.delegate.createRenderer(hostElement,type);if(!(hostElement&&type&&type.data&&type.data.animation)){let renderer=this._rendererCache.get(delegate);if(!renderer){const onRendererDestroy=()=>this._rendererCache.delete(delegate);renderer=new BaseAnimationRenderer("",delegate,this.engine,onRendererDestroy),this._rendererCache.set(delegate,renderer)}return renderer}const componentId=type.id,namespaceId=type.id+"-"+this._currentId;this._currentId++,this.engine.register(namespaceId,hostElement);const registerTrigger=trigger=>{Array.isArray(trigger)?trigger.forEach(registerTrigger):this.engine.registerTrigger(componentId,namespaceId,hostElement,trigger.name,trigger)};return type.data.animation.forEach(registerTrigger),new AnimationRenderer(this,namespaceId,delegate,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(count,fn,data){count>=0&&count<this._microtaskId?this._zone.run(()=>fn(data)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(tuple=>{const[fn,data]=tuple;fn(data)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([fn,data]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}AnimationRendererFactory.ɵfac=function AnimationRendererFactory_Factory(t){return new(t||AnimationRendererFactory)(i0.ɵɵinject(i0.RendererFactory2),i0.ɵɵinject(i1.ɵAnimationEngine),i0.ɵɵinject(i0.NgZone))},AnimationRendererFactory.ɵprov=/* @__PURE__ */i0.ɵɵdefineInjectable({token:AnimationRendererFactory,factory:AnimationRendererFactory.ɵfac}),function(){(typeof ngDevMode==="undefined"||ngDevMode)&&i0.ɵsetClassMetadata(AnimationRendererFactory,[{type:Injectable}],function(){return[{type:i0.RendererFactory2},{type:i1.ɵAnimationEngine},{type:i0.NgZone}]},null)}();class BaseAnimationRenderer{constructor(namespaceId,delegate,engine,_onDestroy){this.namespaceId=namespaceId,this.delegate=delegate,this.engine=engine,this._onDestroy=_onDestroy,this.destroyNode=this.delegate.destroyNode?n=>delegate.destroyNode(n):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(name,namespace){return this.delegate.createElement(name,namespace)}createComment(value){return this.delegate.createComment(value)}createText(value){return this.delegate.createText(value)}appendChild(parent,newChild){this.delegate.appendChild(parent,newChild),this.engine.onInsert(this.namespaceId,newChild,parent,!1)}insertBefore(parent,newChild,refChild,isMove=!0){this.delegate.insertBefore(parent,newChild,refChild),this.engine.onInsert(this.namespaceId,newChild,parent,isMove)}removeChild(parent,oldChild,isHostElement){this.engine.onRemove(this.namespaceId,oldChild,this.delegate,isHostElement)}selectRootElement(selectorOrNode,preserveContent){return this.delegate.selectRootElement(selectorOrNode,preserveContent)}parentNode(node){return this.delegate.parentNode(node)}nextSibling(node){return this.delegate.nextSibling(node)}setAttribute(el,name,value,namespace){this.delegate.setAttribute(el,name,value,namespace)}removeAttribute(el,name,namespace){this.delegate.removeAttribute(el,name,namespace)}addClass(el,name){this.delegate.addClass(el,name)}removeClass(el,name){this.delegate.removeClass(el,name)}setStyle(el,style,value,flags){this.delegate.setStyle(el,style,value,flags)}removeStyle(el,style,flags){this.delegate.removeStyle(el,style,flags)}setProperty(el,name,value){"@"==name.charAt(0)&&"@.disabled"==name?this.disableAnimations(el,!!value):this.delegate.setProperty(el,name,value)}setValue(node,value){this.delegate.setValue(node,value)}listen(target,eventName,callback){return this.delegate.listen(target,eventName,callback)}disableAnimations(element,value){this.engine.disableAnimations(element,value)}}class AnimationRenderer extends BaseAnimationRenderer{constructor(factory,namespaceId,delegate,engine,onDestroy){super(namespaceId,delegate,engine,onDestroy),this.factory=factory,this.namespaceId=namespaceId}setProperty(el,name,value){"@"==name.charAt(0)?"."==name.charAt(1)&&"@.disabled"==name?(value=void 0===value||!!value,this.disableAnimations(el,value)):this.engine.process(this.namespaceId,el,name.slice(1),value):this.delegate.setProperty(el,name,value)}listen(target,eventName,callback){if("@"==eventName.charAt(0)){const element=function(target){switch(target){case"body":return document.body;case"document":return document;case"window":return window;default:return target;}}(target);let name=eventName.slice(1),phase="";return"@"!=name.charAt(0)&&([name,phase]=function(triggerName){const dotIndex=triggerName.indexOf("."),trigger=triggerName.substring(0,dotIndex),phase=triggerName.slice(dotIndex+1);return[trigger,phase]}(name)),this.engine.listen(this.namespaceId,element,name,phase,event=>{const countId=event._data||-1;this.factory.scheduleListenerCallback(countId,callback,event)})}return this.delegate.listen(target,eventName,callback)}}class InjectableAnimationEngine extends ɵAnimationEngine{constructor(doc,driver,normalizer,appRef){super(doc.body,driver,normalizer)}ngOnDestroy(){this.flush()}}InjectableAnimationEngine.ɵfac=function InjectableAnimationEngine_Factory(t){return new(t||InjectableAnimationEngine)(i0.ɵɵinject(DOCUMENT),i0.ɵɵinject(i1.AnimationDriver),i0.ɵɵinject(i1.ɵAnimationStyleNormalizer),i0.ɵɵinject(i0.ApplicationRef))},InjectableAnimationEngine.ɵprov=/* @__PURE__ */i0.ɵɵdefineInjectable({token:InjectableAnimationEngine,factory:InjectableAnimationEngine.ɵfac}),function(){(typeof ngDevMode==="undefined"||ngDevMode)&&i0.ɵsetClassMetadata(InjectableAnimationEngine,[{type:Injectable}],function(){return[{type:void 0,decorators:[{type:Inject,args:[DOCUMENT]}]},{type:i1.AnimationDriver},{type:i1.ɵAnimationStyleNormalizer},{type:i0.ApplicationRef}]},null)}();const SHARED_ANIMATION_PROVIDERS=[{provide:AnimationBuilder,useClass:BrowserAnimationBuilder},{provide:ɵAnimationStyleNormalizer,useFactory:function(){return new ɵWebAnimationsStyleNormalizer}},{provide:ɵAnimationEngine,useClass:InjectableAnimationEngine},{provide:RendererFactory2,useFactory:function(renderer,engine,zone){return new AnimationRendererFactory(renderer,engine,zone)},deps:[ɵDomRendererFactory2,ɵAnimationEngine,NgZone]}],BROWSER_ANIMATIONS_PROVIDERS=[{provide:AnimationDriver,useFactory:()=>new ɵWebAnimationsDriver},{provide:ANIMATION_MODULE_TYPE,useValue:"BrowserAnimations"},...SHARED_ANIMATION_PROVIDERS],BROWSER_NOOP_ANIMATIONS_PROVIDERS=[{provide:AnimationDriver,useClass:ɵNoopAnimationDriver},{provide:ANIMATION_MODULE_TYPE,useValue:"NoopAnimations"},...SHARED_ANIMATION_PROVIDERS];class BrowserAnimationsModule{static withConfig(config){return{ngModule:BrowserAnimationsModule,providers:config.disableAnimations?BROWSER_NOOP_ANIMATIONS_PROVIDERS:BROWSER_ANIMATIONS_PROVIDERS}}}function provideAnimations(){return[...BROWSER_ANIMATIONS_PROVIDERS]}BrowserAnimationsModule.ɵfac=function BrowserAnimationsModule_Factory(t){return new(t||BrowserAnimationsModule)},BrowserAnimationsModule.ɵmod=/* @__PURE__ */i0.ɵɵdefineNgModule({type:BrowserAnimationsModule}),BrowserAnimationsModule.ɵinj=/* @__PURE__ */i0.ɵɵdefineInjector({providers:BROWSER_ANIMATIONS_PROVIDERS,imports:[BrowserModule]}),function(){(typeof ngDevMode==="undefined"||ngDevMode)&&i0.ɵsetClassMetadata(BrowserAnimationsModule,[{type:NgModule,args:[{exports:[BrowserModule],providers:BROWSER_ANIMATIONS_PROVIDERS}]}],null,null)}();class NoopAnimationsModule{}function provideNoopAnimations(){return[...BROWSER_NOOP_ANIMATIONS_PROVIDERS]}NoopAnimationsModule.ɵfac=function NoopAnimationsModule_Factory(t){return new(t||NoopAnimationsModule)},NoopAnimationsModule.ɵmod=/* @__PURE__ */i0.ɵɵdefineNgModule({type:NoopAnimationsModule}),NoopAnimationsModule.ɵinj=/* @__PURE__ */i0.ɵɵdefineInjector({providers:BROWSER_NOOP_ANIMATIONS_PROVIDERS,imports:[BrowserModule]}),function(){(typeof ngDevMode==="undefined"||ngDevMode)&&i0.ɵsetClassMetadata(NoopAnimationsModule,[{type:NgModule,args:[{exports:[BrowserModule],providers:BROWSER_NOOP_ANIMATIONS_PROVIDERS}]}],null,null)}();export{BrowserAnimationsModule,NoopAnimationsModule,provideAnimations,provideNoopAnimations,AnimationRenderer as ɵAnimationRenderer,AnimationRendererFactory as ɵAnimationRendererFactory,BrowserAnimationBuilder as ɵBrowserAnimationBuilder,BrowserAnimationFactory as ɵBrowserAnimationFactory,InjectableAnimationEngine as ɵInjectableAnimationEngine};